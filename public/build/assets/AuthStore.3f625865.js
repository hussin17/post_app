import{aB as R,B as V,i as m}from"./app.94623934.js";import{f as s}from"./index.esm.074946f0.js";import"./auth.esm.ec72dae1.js";import{P as p}from"./PsApiService.16e28b45.js";import{A as d}from"./ApiStatus.5720ba0b.js";import{P as k}from"./PsObject.a17ef38f.js";import{U as h}from"./User.fb568515.js";class g extends k{constructor(){super(...arguments),this.status="",this.message={}}init(a,u){return this.status=a,this.message=u,this}getPrimaryKey(){return this.status}fromMap(a){return new g().init(a.status,a.message)}fromMapList(a){const u=[];for(const c in a)c!=null&&u.push(this.fromMap(c));return u}toMap(a){const u={};return u.status=a.status,u.message=a.message,u}toMapList(a){const u=[];for(let c=0;c<a.length;c++)a[c]!=null&&u.push(this.toMap(a[c]));return u}}const z=R("authStore",()=>{const l=V({value:!1}),a=m(""),u=m();async function c(t,e){try{return await s.auth().createUserWithEmailAndPassword(t,e),!0}catch(i){a.value=i;try{const n=await s.auth().fetchSignInMethodsForEmail(t);return!0}catch(n){return a.value=n,console.log(n),!1}}}async function w(t,e){try{return await s.auth().signInWithEmailAndPassword(t,t),!0}catch(i){console.log(i);try{return await c(t,t),!0}catch(n){return a.value=n,console.log(n),!1}}}function y(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function P(t){l.value=t}async function U(){var i;const t=new s.auth.GoogleAuthProvider;t.addScope("email");const e=await s.auth().signInWithPopup(t).catch(n=>{a.value=n.message,console.log(a.value)});if(e!=null&&e.credential!=null){const n=(i=e.credential)!=null?i:null;let r;try{r=await s.auth().signInWithCredential(n);const o=s.auth().currentUser}catch{a.value="Google login failed."}if(s.auth()!=null&&r!=null&&r.user!=null){const o=r.user;if(o!=null)return o;a.value="Google login failed."}}}async function M(){var i;const t=new s.auth.OAuthProvider("apple.com"),e=await s.auth().signInWithPopup(t).catch(n=>{a.value=n.message});if(e!=null&&e.credential!=null){const n=(i=e.credential)!=null?i:null;let r;try{r=await s.auth().signInWithCredential(n)}catch{a.value="Apple login failed."}if(s.auth()!=null&&r!=null&&r.user!=null){const o=r.user;if(o!=null)return o;a.value="Apple login failed."}}}async function A(){var i;const t=new s.auth.FacebookAuthProvider;t.addScope("email");const e=await s.auth().signInWithPopup(t).catch(n=>{a.value=n.message});if(e!=null&&e.credential!=null){const n=(i=e.credential)!=null?i:null;let r;try{r=await s.auth().signInWithCredential(n)}catch{a.value="Facebook login failed."}if(s.auth()!=null&&r!=null&&r.user!=null){const o=r.user;if(o!=null)return o;a.value="Facebook login failed."}}}async function C(t){return l.value=!0,await p.getUserExist(new d,t.toMap())}async function I(t){return await p.postUserCreate(new g,t.toMap())}async function W(t){var i,n,r,o,v;l.value=!0;let e="";if(t!=null&&(e=(i=t.email)!=null?i:"",(e==null||e=="")&&t.providerData!=null&&t.providerData.length>0))for(let f=0;f<t.providerData.length;f++)((n=t.providerData[f])==null?void 0:n.email)!=null&&((r=t.providerData[f])==null?void 0:r.email)!=""&&(e=(v=(o=t.providerData[f])==null?void 0:o.email)!=null?v:"");return t}async function D(t){l.value=!0;const e=await p.postForgotPassword(new d,t.toMap());return l.value=!1,e}async function S(t){l.value=!0;const e=await p.postUserCodeVerify(new h,t.toMap());return l.value=!1,e}async function E(t){l.value=!0;const e=await p.postResetPassword(new d,t.toMap());return l.value=!1,e}async function b(t){this.loading.value=!0;const e=await p.postUserRegister(new h,t.toMap());return this.loading.value=!1,e}async function F(t){l.value=!0;const e=await p.postUserEmailVerify(new h,t.toMap());return l.value=!1,e}async function G(t){l.value=!0;const e=await p.postResendCode(new d,t);return l.value=!1,e}return{postResendCode:G,postUserEmailVerify:F,registerUser:b,postUserCodeVerify:S,postResetPassword:E,postForgotPassword:D,createUserWithEmailAndPassword:c,signInWithEmailAndPassword:w,errorMessage:a,loginWithGoogleId:U,loading:l,submitLoginWithGoogleId:W,googleUser:u,existUser:C,createUserwithUsername:I,setLoading:P,isEmpty:y,loginWithFacebookId:A,loginWithAppleSignIn:M}});export{z as u};
